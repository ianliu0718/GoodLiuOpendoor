# 版本歷程（Changelog）

本檔案記錄 `GoodLiuOpendoor.ino` 的歷次功能變更與重要調整。

## v1.1.5
- MQTT 遠端控制功能
  - 連線至 MQTT Broker（`liunas2323.synology.me:1883`）
  - Topic `door/open`：接收開門訊號（訊息內容：`"open"`）
  - Topic `door/add_temp_pw`：接收新增臨時密碼 JSON 訊息
  - 自動重連機制，WiFi 連線成功後自動連線 MQTT
- 臨時密碼 MQTT 支援
  - 新增通用函數 `addTempPassword()` 供 HTTP 和 MQTT 共用
  - 支援 JSON 格式：`{ "pw": "1234", "expire": "2024-12-31T23:59", "count": 5 }`
  - 完整驗證機制（密碼格式、時間格式、使用次數）
- 後端 API 擴充（server.js v2.1.4+）
  - 新增 `POST /api/add_temp_pw` API 端點
  - 透過 MQTT 發送 JSON 訊息至 ESP32
  - Token 驗證與完整錯誤處理
- 前端頁面更新（index.html）
  - 新增臨時密碼表單 UI（密碼、到期時間、使用次數）
  - 優化樣式設計（卡片式布局、響應式設計）
  - 前端驗證與狀態顯示
- 文件更新
  - 更新使用說明文件，新增 MQTT API 章節
  - 新增系統架構圖與資料流向說明
  - 更新錯誤碼說明

## v1.0.8
- 平台：完成 ESP8266 → ESP32 遷移
  - `ESP8266WiFi`/`ESP8266WebServer` → `WiFi.h`/`WebServer.h`
  - `EEPROM` → `Preferences`（儲存 WiFi、主密碼、臨時密碼、指紋名單與名稱）
  - `Servo` → `ESP32Servo`（避免 AVR 相依，加入安全附掛/脫掛與冷卻機制）
- 指紋功能（AS608）
  - UART1：`fingerSerial.begin(57600, SERIAL_8N1, FINGER_RX, FINGER_TX)`
  - 功能：註冊、辨識、刪除
  - 新增名單/名稱持久化：`fp_ids`、`fp_name_<id>`
  - 新增 API：`/list_fingers`、`/rename_finger`、`/delete_finger`
- MAX7219 顯示
  - 改用 `MD_MAX72xx`（注意檔名大小寫），正確的建構式：
    - `MD_MAX72XX(MD_MAX72XX::FC16_HW, DATA_PIN, CLK_PIN, CS_PIN, MAX_DEVICES)`
  - 統一顯示副程式：`showTextOnLed()`、`showPasswordOnLed()`、`showErrorNoOnLed()`、`showResult()`、`clearDisplay()`
- 網頁 UI
  - 主密碼/臨時密碼：新增/刪除/清單/清空
  - 指紋清單：顯示 ID 與名稱，支援改名與刪除
- 其他
  - NTP 校時（`time.h`）供臨時密碼到期判斷
  - 調整腳位避免共用（Keypad、MAX7219、指紋、Servo）

## v1.0.7
- 新增臨時密碼功能（次數與到期），加入 NTP 校時
- 網頁介面優化，提供臨時密碼管理 API

## v1.0.6
- 新增指紋辨識流程與 MAX7219 顯示優化
- 顯示狀態/錯誤/結果於 LED 模組

## v1.0.5
- 新增網頁設定 WiFi（AP 模式進入設定頁）

## v1.0.4
- 新增主密碼網頁修改 API

## v1.0.3
- 修正伺服馬達抖動，加入安全斷開機制（attach/detach）

## v1.0.2
- 調整按鍵掃描頻率、去抖動，改善鬼鍵問題

## v1.0.1
- 初版：實作基本密碼開鎖、MAX7219 基礎顯示

---

若有後續版本更新，請於此檔案持續追加條目。

